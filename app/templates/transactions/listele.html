{% extends 'base.html' %}
{% block title %}İşlemler{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">İşlem Geçmişi</h1>
  <a href="#islemFormu" class="btn btn-primary" data-bs-toggle="collapse">Yeni İşlem Ekle</a>
</div>

<div class="collapse mb-4" id="islemFormu">
  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <form method="post" novalidate>
        {{ form.hidden_tag() }}
        <div class="row g-3">
          <div class="col-md-3">
            {{ form.islem_turu.label(class="form-label") }}
            {{ form.islem_turu(class="form-select") }}
            {% for hata in form.islem_turu.errors %}
              <div class="text-danger small">{{ hata }}</div>
            {% endfor %}
          </div>
          <div class="col-md-3">
            {{ form.hesap_id.label(class="form-label") }}
            {{ form.hesap_id(class="form-select") }}
            {% for hata in form.hesap_id.errors %}
              <div class="text-danger small">{{ hata }}</div>
            {% endfor %}
          </div>
          <div class="col-md-3">
            {{ form.kategori_id.label(class="form-label") }}
            {{ form.kategori_id(class="form-select") }}
            {% for hata in form.kategori_id.errors %}
              <div class="text-danger small">{{ hata }}</div>
            {% endfor %}
          </div>
          <div class="col-md-3">
            {{ form.tutar.label(class="form-label") }}
            {{ form.tutar(class="form-control") }}
            {% for hata in form.tutar.errors %}
              <div class="text-danger small">{{ hata }}</div>
            {% endfor %}
          </div>
        </div>
        <div class="row g-3 mt-1">
          <div class="col-md-3">
            {{ form.tarih.label(class="form-label") }}
            {{ form.tarih(class="form-control") }}
            {% for hata in form.tarih.errors %}
              <div class="text-danger small">{{ hata }}</div>
            {% endfor %}
          </div>
          <div class="col-md-9">
            {{ form.aciklama.label(class="form-label") }}
            {{ form.aciklama(class="form-control", rows=1, placeholder="İsteğe bağlı açıklama") }}
            {% for hata in form.aciklama.errors %}
              <div class="text-danger small">{{ hata }}</div>
            {% endfor %}
          </div>
        </div>
        <div class="mt-3">
          {{ form.submit(class="btn btn-success") }}
        </div>
      </form>
    </div>
  </div>
</div>

<div class="card border-0 shadow-sm">
  <div class="table-responsive">
    <table class="table table-striped mb-0">
      <thead class="table-light">
        <tr>
          <th>Tarih</th>
          <th>Tür</th>
          <th>Hesap</th>
          <th>Kategori</th>
          <th>Tutar</th>
          <th>Açıklama</th>
          <th class="text-end">İşlemler</th>
        </tr>
      </thead>
      <tbody>
        {% for islem in islemler %}
          <tr>
            <td>{{ islem.tarih|turkce_tarih }}</td>
            <td>
              <span class="badge {{ 'bg-success' if islem.islem_turu == 'gelir' else 'bg-danger' }}">
                {{ 'Gelir' if islem.islem_turu == 'gelir' else 'Gider' }}
              </span>
            </td>
            <td>{{ islem.hesap.ad }}</td>
            <td>{{ islem.kategori.ad }}</td>
            <td>₺{{ '%.2f'|format(islem.tutar) }}</td>
            <td>{{ islem.aciklama or '-' }}</td>
            <td class="text-end">
              <a href="{{ url_for('transactions.duzenle', islem_id=islem.id) }}" class="btn btn-sm btn-outline-secondary">Düzenle</a>
              <form method="post" action="{{ url_for('transactions.sil', islem_id=islem.id) }}" class="d-inline" onsubmit="return confirm('İşlem silinsin mi?');">
                {{ csrf_token() }}
                <button type="submit" class="btn btn-sm btn-outline-danger">Sil</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="7">Henüz kayıtlı işlem bulunmuyor.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
